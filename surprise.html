<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday!</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Arial', sans-serif; }
        body { overflow: hidden; background-color: #000; color: white; text-align: center; }
        
        /* Screens */
        .screen { position: absolute; width: 100vw; height: 100vh; display: none; flex-direction: column; justify-content: center; align-items: center; transition: transform 0.5s ease, opacity 0.5s ease; background-size: cover; background-position: center; z-index: 10; }
        .screen.active { display: flex; z-index: 10; }
        
        /* UI Elements */
        input { padding: 10px; font-size: 18px; margin: 20px 0; border-radius: 5px; border: none; text-align: center; color: black; z-index: 20; position: relative; }
        button { padding: 12px 24px; font-size: 18px; background-color: #ff4d6d; color: white; border: none; border-radius: 8px; cursor: pointer; z-index: 20; position: relative; }
        .arrow-btn { margin-top: 30px; font-size: 24px; background-color: rgba(0,0,0,0.5); border-radius: 50%; width: 60px; height: 60px; }
        .hidden { display: none !important; }

        .balloon-container { display: flex; gap: 20px; margin-top: 20px; z-index: 20; position: relative; }
        .balloon { font-size: 60px; cursor: pointer; transition: transform 0.2s; }
        .balloon:active { transform: scale(0.8); }

        #photoSection { z-index: 20; position: relative; }
        #photoSection img { max-width: 80%; max-height: 40vh; border-radius: 15px; margin: 20px 0; border: 3px solid white; }
        
        #finalVideo { max-width: 90%; max-height: 60vh; border-radius: 10px; margin-bottom: 20px; z-index: 20; position: relative; }
        .letter-box { width: 80%; font-size: 20px; line-height: 1.6; margin-bottom: 20px; background: rgba(0,0,0,0.5); padding: 20px; border-radius: 10px; z-index: 20; position: relative; }

        /* Animations */
        .slide-out-left { transform: translateX(-100%); opacity: 0; }
        .slide-in-right { transform: translateX(100%); display: flex !important; }
        .slide-in-active { transform: translateX(0); }

        /* Falling Hearts Effect */
        #heartsContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none; /* Prevents hearts from blocking your taps! */
            z-index: 5; /* Puts hearts behind text but in front of background */
            overflow: hidden;
            display: none;
        }

        .falling-heart {
            position: absolute;
            top: -10vh;
            font-size: 24px;
            animation: fall linear forwards;
            opacity: 0.8;
        }

        @keyframes fall {
            0% { transform: translateY(0) rotate(0deg) scale(1); opacity: 1; }
            100% { transform: translateY(110vh) rotate(360deg) scale(1.5); opacity: 0; }
        }
    </style>
</head>
<body>

    <div id="heartsContainer"></div>

    <div id="screen1" class="screen active">
        <h1 style="z-index: 20; position: relative;">enter your full name‚ù§Ô∏è</h1>
        <input type="text" id="passwordBox" placeholder="Type here...">
        <button onclick="checkPassword()">Enter</button>
    </div>

    <div id="screen2" class="screen">
        <h1 id="countdownText" class="hidden" style="font-size: 80px; z-index: 20; position: relative;">3</h1>
        <div id="cakeSection" class="hidden" style="z-index: 20; position: relative;">
            <div id="partyDecor" class="hidden" style="font-size: 40px; margin-bottom: 20px;">üéäüéâüéä</div>
            <div id="cakeArea" onclick="decorateCake()" style="cursor: pointer;">
                <span id="cakeGraphic" style="font-size: 100px;">üéÇ</span>
                <p id="decorateHint">Tap to decorate!</p>
            </div>
            <div id="knife" class="hidden" onclick="cutCake()" style="font-size: 60px; cursor: pointer; margin-top: 20px;">üî™</div>
            <h2 id="bdayMessage" class="hidden" style="margin-top: 20px; color: #ffeb3b; text-shadow: 2px 2px 4px #000;">happy birthday mera betu ‚ù§Ô∏è</h2>
            <button id="arrowTo3" class="hidden arrow-btn" onclick="slideScreen(2, 3)">‚û°Ô∏è</button>
        </div>
    </div>

    <div id="screen3" class="screen">
        <h2 style="z-index: 20; position: relative;">Tap to burst!</h2>
        <div class="balloon-container">
            <div class="balloon" onclick="burstBalloon(this)">üéà</div>
            <div class="balloon" onclick="burstBalloon(this)">üéà</div>
            <div class="balloon" onclick="burstBalloon(this)">üéà</div>
            <div class="balloon" onclick="burstBalloon(this)">üéà</div>
        </div>
        <button id="arrowTo4" class="hidden arrow-btn" onclick="slideScreen(3, 4)">‚û°Ô∏è</button>
    </div>

    <div id="screen4" class="screen">
        <audio id="bubuuSong"></audio>
        <button id="playBtn" onclick="playMusicAndShowPhoto()">song for u bubuu</button>
        <div id="photoSection" class="hidden">
            <img id="firstPhotoImg" src="" alt="First Photo">
            <p style="background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px;">apni pahali photo which made me fall more for u mera bacha ü•∫</p>
            <button style="margin-top: 20px;" onclick="slideScreen(4, 5)">want to read what I wrote for u</button>
        </div>
    </div>

    <div id="screen5" class="screen">
        <div class="letter-box">
            <p id="typewriterText"></p>
        </div>
        <button id="arrowTo6" class="hidden arrow-btn" onclick="slideScreen(5, 6)" style="width: auto; padding: 10px 20px; border-radius: 20px;">abhi aage bhi hai toda sa ‚û°Ô∏è</button>
    </div>

    <div id="screen6" class="screen">
        <video id="finalVideo" controls playsinline preload="auto"></video>
        <p id="finalText" class="hidden" style="margin-top:20px; font-size:18px; z-index: 20; position: relative;">thank u for coming in my life ‚ù§Ô∏èü•π and once again wish u a very very happy birathday my betu</p>
    </div>

    <script>
        let appData = {};
        let poppedBalloons = 0;
        let heartInterval;

        // On Load: Extract Data from URL
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const encoded = params.get('d');
            
            if (encoded) {
                try {
                    appData = JSON.parse(decodeURIComponent(atob(encoded)));
                    
                    // Apply Backgrounds - Screen 6 now uses the Romantic Background (rbg) too!
                    document.getElementById('screen1').style.backgroundImage = `url('${appData.dbg}')`;
                    document.getElementById('screen2').style.backgroundImage = `url('${appData.rbg}')`;
                    document.getElementById('screen3').style.backgroundImage = `url('${appData.rbg}')`;
                    document.getElementById('screen4').style.backgroundImage = `url('${appData.rbg}')`;
                    document.getElementById('screen5').style.backgroundImage = `url('${appData.rbg}')`;
                    document.getElementById('screen6').style.backgroundImage = `url('${appData.rbg}')`;
                    
                    // Apply Media
                    document.getElementById('firstPhotoImg').src = appData.img;
                    document.getElementById('bubuuSong').src = appData.aud;
                    document.getElementById('finalVideo').src = appData.vid;
                } catch(e) {
                    alert("Link is broken or invalid.");
                }
            } else {
                alert("No data found! Please generate the link via the admin page.");
            }
        };

        function startFallingHearts() {
            const container = document.getElementById("heartsContainer");
            container.style.display = "block";
            
            // Create a new heart every 400 milliseconds
            heartInterval = setInterval(() => {
                const heart = document.createElement("div");
                heart.classList.add("falling-heart");
                
                // Randomize heart emojis
                const hearts = ["‚ù§Ô∏è", "üíñ", "üíï", "üíã"];
                heart.innerText = hearts[Math.floor(Math.random() * hearts.length)];
                
                // Randomize position, size, and speed
                heart.style.left = Math.random() * 100 + "vw";
                heart.style.animationDuration = (Math.random() * 3 + 3) + "s"; // Takes 3 to 6 seconds to fall
                heart.style.fontSize = (Math.random() * 20 + 15) + "px"; // Size between 15px and 35px
                
                container.appendChild(heart);
                
                // Remove heart after it finishes falling so the phone doesn't freeze
                setTimeout(() => {
                    heart.remove();
                }, 6000); 
            }, 400);
        }

        function checkPassword() {
            const input = document.getElementById("passwordBox").value.trim().toLowerCase();
            if (input === "shivani thakur") {
                slideScreen(1, 2);
                startFallingHearts(); // Start the hearts animation right here!
                setTimeout(startCountdown, 600);
            } else {
                alert("retry karo üòí\nHint: 2 words are there with space between them");
            }
        }

        function slideScreen(currentId, nextId) {
            const curr = document.getElementById(`screen${currentId}`);
            const next = document.getElementById(`screen${nextId}`);
            curr.classList.add("slide-out-left");
            next.classList.add("slide-in-right");
            next.classList.remove("hidden");
            void next.offsetWidth; 
            next.classList.remove("slide-in-right");
            next.classList.add("active", "slide-in-active");
            setTimeout(() => {
                curr.classList.remove("active", "slide-out-left");
                if(nextId === 5) triggerTypewriter();
                if(nextId === 6) showFinalText();
            }, 500);
        }

        function startCountdown() {
            const txt = document.getElementById("countdownText");
            const cake = document.getElementById("cakeSection");
            txt.classList.remove("hidden");
            let count = 3;
            const intv = setInterval(() => {
                count--;
                if (count > 0) txt.innerText = count;
                else { clearInterval(intv); txt.classList.add("hidden"); cake.classList.remove("hidden"); }
            }, 1000);
        }

        function decorateCake() {
            document.getElementById("partyDecor").classList.remove("hidden");
            document.getElementById("decorateHint").classList.add("hidden");
            document.getElementById("knife").classList.remove("hidden");
            document.getElementById("cakeGraphic").innerText = "üéÇ‚ú®"; 
        }

        function cutCake() {
            document.getElementById("bdayMessage").classList.remove("hidden");
            document.getElementById("arrowTo3").classList.remove("hidden");
        }

        function burstBalloon(el) {
            el.style.visibility = "hidden";
            poppedBalloons++;
            if (poppedBalloons === 4) document.getElementById("arrowTo4").classList.remove("hidden");
        }

        function playMusicAndShowPhoto() {
            document.getElementById("bubuuSong").play();
            document.getElementById("playBtn").classList.add("hidden");
            document.getElementById("photoSection").classList.remove("hidden");
        }

        function triggerTypewriter() {
            const el = document.getElementById("typewriterText");
            const text = appData.txt || "Happy Birthday!";
            el.innerText = "";
            let i = 0;
            const speed = 4000 / text.length; 
            function typeWriter() {
                if (i < text.length) {
                    el.innerHTML += text.charAt(i); i++;
                    setTimeout(typeWriter, speed);
                } else {
                    document.getElementById("arrowTo6").classList.remove("hidden");
                }
            }
            typeWriter();
        }

        function showFinalText() {
            document.getElementById("finalVideo").play();
            setTimeout(() => { document.getElementById("finalText").classList.remove("hidden"); }, 2000);
        }
    </script>
</body>
</html>
